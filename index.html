<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <title>ElectronicColoringBook by doegox</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>ElectronicColoringBook</h1>
        <h2>Colorize data file according to repetitive chunks, typical in ECB encrypted</h2>

        <section id="downloads">
          <a href="https://github.com/doegox/ElectronicColoringBook/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/doegox/ElectronicColoringBook/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/doegox/ElectronicColoringBook" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h3>
<a name="welcome-to-the-electronic-coloring-book-project-page" class="anchor" href="#welcome-to-the-electronic-coloring-book-project-page"><span class="octicon octicon-link"></span></a>Welcome to the Electronic Coloring Book project page.</h3>

<p>The name is obviously a wordplay with <a href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Electronic_codebook_.28ECB.29">Electronic Codebook</a>, the simplest but also the most unsecure chaining mode of operations to be used with a block cipher.</p>

<p>From Wikipedia:</p>

<blockquote>
<p>The disadvantage of this method is that identical plaintext blocks are encrypted into identical ciphertext blocks; thus, it does not hide data patterns well. In some senses, it doesn't provide serious message confidentiality, and it is not recommended for use in cryptographic protocols at all.
A striking example of the degree to which ECB can leave plaintext data patterns in the ciphertext can be seen when ECB mode is used to encrypt a bitmap image which uses large areas of uniform colour. While the colour of each individual pixel is encrypted, the overall image may still be discerned as the pattern of identically coloured pixels in the original remains in the encrypted version.</p>
</blockquote>

<p>This is typically illustrated with our favorite mascotte:</p>

<p><img src="https://upload.wikimedia.org/wikipedia/commons/f/f0/Tux_ecb.jpg" alt="ecb tux"></p>

<p>Yes we can see it despite it's encrypted, but it's neither that obvious nor visually satisfying, for several reasons we'll explain. We can do better! And that's the goal of this little project.</p>

<h3>
<a name="why-ecb-forensics-isnt-that-easy" class="anchor" href="#why-ecb-forensics-isnt-that-easy"><span class="octicon octicon-link"></span></a>Why ECB forensics isn't that easy?</h3>

<p>Those ECB exemplary images are made artificially: the author knows the original file format (width, height, pixel encoding) and typically overwrites the encrypted header with the original one.</p>

<p>But when a file is encrypted and you don't know anything about it, it's not that simple.
<br>One example is the 300 points challenge of the <em>2014 Nuit du Hack CTF Quals</em> called <em>The Another One</em>. All you get is an encrypted BMP (as you can guess from the file extension). More details on the resolution of that challenge are available <a href="http://wiki.yobi.be/wiki/NDH_Writeups#Another_One">here</a>.</p>

<p>It appears quickly that there are recurring encrypted blocks but practical problems are to recover the unknown parameters:</p>

<ul>
<li>width and height of the image</li>
<li>pixel encoding. Here it's a BMP but BMP can <a href="https://en.wikipedia.org/wiki/BMP_file_format#Pixel_format">encode each pixel</a> in 1 bit, 2 bits, 4 bits, 8 bits, 16 bits, 24 bits or 32 bits so that doesn't really help.</li>
<li>layout. Here it's a BMP so starting from bottom left to top right, line by line.</li>
</ul><p>Pixel encoding, width and height link back to the total encrypted file size:</p>

<p><em>header + width * height * bytes_per_pixel + padding = filesize</em></p>

<p>Here is another example we'll walk through. For the record the binary blob was created from some ppm (as we need a non-compressed bitmap to start with) as:</p>

<p><code>openssl enc -e -aes-128-ecb -in test.ppm -out test.bin -k toto</code></p>

<p>test.bin is available <a href="./images/test.bin">here</a></p>

<p>At first we'll use a square ratio and color each byte.</p>

<p><img src="./images/test.bin.1.png" alt="test.bin.1"></p>

<p>Nothing really recognizable, isn't it?</p>
      </section>
    </div>

    
  </body>
</html>